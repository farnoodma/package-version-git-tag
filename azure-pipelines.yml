# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  - master

parameters:
  vmImages:
    - ubuntu-latest
    - windows-latest
  nodeVersions:
    - 8.10.0
    - 8.x
    - 9.0.0
    - 9.x
    - 10.0.0
    - 10.x
    - 11.0.0
    - 11.x
    - 12.0.0
    - 12.x
    - 13.0.0
    - 13.x

jobs:
  ${{ each vmImage in parameters.vmImages }}:
    - job: ${{ vmImage }}

      pool:
        vmImage: ${{ vmImage }}

      strategy:
        matrix:
          ${{ each nodeVersion in parameters.nodeVersions }}:
            ${{ format('Node.js {0} / {1}', nodeVersion, vmImage) }}:
              node_version: ${{ nodeVersion }}

      steps:
        - task: NodeTool@0
          inputs:
            versionSpec: $(node_version)
          displayName: Install Node.js

        - script: |
            echo node $(node --version)
            echo npm $(npm --version)
          displayName: Show node and npm version

        - script: npm ci || npm install
          displayName: Install dependencies

        - script: npm test
          displayName: Run test
